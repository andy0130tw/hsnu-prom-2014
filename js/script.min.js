/*! Global variables */
;var routeSelector={};var cacheStorage={};var originalTitle;
/*! Constants */
;var FX_SLIDE_DURATION=500;var FX_MFP_REMOVAL_DELAY=250;var termTranslation={home:"首頁",news:"新聞報導",decoration:"校園佈置",show:"活動實況",souvenir:"紀念品",video:"相關影片",tech:"技術","404":"Error 404",http_error:"Loading Error"};var CONST_AFFIX_SETTINGS={offset:{top:10+$("#header").outerHeight(true),bottom:function(){return 30+($(this).bottom=$("#footer").outerHeight(true)+$("#social-button-container").outerHeight(true))}}};
/*! polyfill from mdn */
;Array.prototype.indexOf||(Array.prototype.indexOf=function(c,b){if(void 0===this||null===this){throw new TypeError('"this" is null or not defined')}var a=this.length>>>0;for(b=+b||0,1/0===Math.abs(b)&&(b=0),0>b&&(b+=a,0>b&&(b=0));a>b;b++){if(this[b]===c){return b}}return -1});
/*! util */
;var modal={show:function(c,b,a){$.magnificPopup.open({items:{src:$(c)},modal:b,mainClass:"mfp-fade "+a,type:"inline"})},image:function(b,a){$.magnificPopup.open({items:{src:b,title:a},type:"image"})}};function thumbFN(a,b){if(!a.src){return""}return"image/thumb/"+(b?b+"/":"")+a.src}function imageFN(a,b){if(!a.src){return""}return"image/photo/"+(b?b+"/":"")+a.src}function fill(b,a){b=""+b;while(b.length<a){b="0"+b}return b}function translateMFP(){$.extend(true,$.magnificPopup.defaults,{mainClass:"mfp-fade",removalDelay:FX_MFP_REMOVAL_DELAY,tClose:"關閉 (ESC)",tLoading:"載入中…",gallery:{tPrev:"上一張 (←)",tNext:"下一張 (→)",tCounter:"%curr% / %total%",preload:[2,4]},image:{tError:'<a href="%url%">本圖片</a>無法載入！',titleSrc:function(a){var b=a.el?a.el.attr("title"):a.src;return(b?b+" &middot; ":"")+'<a class="mfp-link-original" href="'+a.src+'" target="_blank">顯示原圖</a>'}},ajax:{tError:'<a href="%url%">本內容</a>無法載入！'},inline:{tNotFound:"找不到引用的內容。請通知網頁作者！"}})}function hashIsDerived(){var b=routie.find(routie.previous());var a=routie.find();if(b===null||a===null){return false}return b.is(a)}function deferredRoute(c,b,d,a){return function(){if(d){navUpdate(d);originalTitle=originalTitle||document.title;var f=termTranslation[d]||d;if(f!==""){f=f+=" | "}document.title=(f||d)+originalTitle}var g=this;var e=arguments;var h=function(){var i;if(a){i=a.apply(g,e)}};if(!$(c)||!$(c).length){loadExt(b,function(i){h()})}else{h()}}}
/*! for generating routes' definition */
;function albumDeferredRouteFactory(b){var c="!/"+b;var a="#"+b+"-content";return deferredRoute(a,"ajax/"+b+".html",b,function(f){var h=$(a);var e=h.data("mfp-items");var g=$.magnificPopup.instance;var d=f-1;if(!e){e=[];h.find(".cell > a").each(function(){e.push(this)});h.data("mfp-items",e)}if(f){if(f<0){return}if(d>=e.length){return}$.magnificPopup.open({items:h.data("mfp-items"),gallery:{enabled:true},type:"image",callbacks:{beforeClose:function(){var i=routie.findAll()[0].toURL({});routie.navigate(i,{silent:true})},change:function(){var i=routie.findAll(c)[1].toURL({num:g.index+1});routie.navigate(i,{silent:true})}}},d)}else{g.close()}})}function initHashHandler(){var h=function(){if(["","#!","#!/"].indexOf(location.hash)>=0){try{history.replaceState({},document.title,location.href.split("#")[0])}catch(j){}}};$(window).hashchange(h);h();var g=deferredRoute("#home-content","ajax/landing.html","home");var i=deferredRoute("#news-content","ajax/news.html","news",function(k){if(k){var j=$("#news-content").find("[data-hashid='"+k+"']").eq(0);if(j.length){slideTo(j.offset().top-$("#menu-wrapper").innerHeight()-3)}else{slideTo(0)}}});var a=deferredRoute("#tech-content","ajax/tech.html","tech",function(k){if(k){var j=$("#tech-content").find("[data-hashid='"+k+"']").eq(0);if(j.length){slideTo(j.offset().top-$("#menu-wrapper").innerHeight()-3)}else{slideTo(0)}}});var b=deferredRoute("#video-content","ajax/video.html","video",function(k){if(k){if(k<=0){return}var l=$("#popup-video");var j=$("#video-content").find(".action-video").eq(k-1);if(!j.length){return}$.magnificPopup.open({type:"inline",items:{src:l},callbacks:{beforeClose:function(){var m=routie.findAll()[0].toURL([]);routie.navigate(m,{silent:true})}}});l.find("h2").html(j.data("title"));l.find("iframe").attr("src","http://www.youtube.com/embed/"+j.data("id")+"?rel=0")}});var d=albumDeferredRouteFactory("show");var f=albumDeferredRouteFactory("decoration");var c=albumDeferredRouteFactory("souvenir");var e=deferredRoute("","ajax/404.html","404");routeSelector={"":g,"!":g,"!/":g,"!/news":i,"!/news/:section?":i,"!/tech":a,"!/tech/:section?":a,"!/video":b,"!/video/:num?":b,"!/show":d,"!/show/:num?":d,"!/souvenir":c,"!/souvenir/:num?":c,"!/decoration":f,"!/decoration/:num?":f,"*":e};routie.before(function(k,l){var j=$.magnificPopup.instance;if(!hashIsDerived()&&j.isOpen){j.close()}});routie(routeSelector)}
/*! starting up */
;function main(){initPlugins();translateMFP();registerListeners();initSocial();initHashHandler();console.log("Welcome, the developer. I've been here, waiting for you for a long time!")}function initSocial(){var b=location.href.split("#")[0];var c=document.title;var a=encodeURIComponent(b);var d=$("#social-button-container");d.children("._fb").replaceWith('<div class="fb-like" data-href="'+b+'" data-layout="button_count" data-action="like" data-show-faces="false" data-share="false">[Facebook]</div>');d.children("._twttr").replaceWith('<a href="https://twitter.com/share" class="twitter-share-button" data-url="'+b+'" data-via="andy0130tw" data-lang="en">Tweet</a>');d.children("._gplus").replaceWith('<div class="g-plusone" data-size="medium">[Google+]</div>');gapi.plusone.go();var e=d.children("div.fill-social-buttons");e.children(".facebook").click(function(){return void (window.open("http://www.facebook.com/share.php?u="+a))});e.children(".googleplus").click(function(){return void (window.open("https://plus.google.com/share?url="+a))});e.children(".plurk").click(function(){return void (window.open("http://www.plurk.com/?qualifier=shares&status="+a+" ("+c+")"))});e.children(".twitter").click(function(){return void (window.open("http://twitter.com/home/?status="+c+" | "+a))})}function initPlugins(){$.fn.htmlWithScript=function(raw){var self=$(this);return this.each(function(){var data=$.parseHTML(raw,document,true);var snippet=[];for(var i=0;i<data.length;++i){var frag=data[i];var tagN=frag.tagName;if(tagN&&tagN.toLowerCase()=="script"){snippet.push(frag.innerHTML);data[i]=""}}self.empty().html(data);var code=snippet.join("\n");(function(){eval(code)}).call(self)})};$.fn.gallery=function(items,basePath,hashString){var self=$(this);basePath=basePath||"";return this.each(function(){if(items){var buf="";for(var i=0;i<items.length;++i){var item=items[i];var title=item.title||"";buf+="<div class='cell'><a href='"+imageFN(item,basePath)+"' title='"+title+"'><img src='"+thumbFN(item,basePath)+"'/></a></div>"}self.addClass("gallery-grid clearfix").empty().html(buf).on("click",".cell",function(){var num=$(this).index();routie.navigate("#!/"+(hashString||basePath)+"/"+(num+1));return false})}else{self.removeClass("gallery-grid").empty()}})}}function registerListeners(){$("img.logo").click(function(){modal.image($(this).attr("src").split("logo.").join("logo-ori."),"LOGO")});$("#link-cpyr").click(function(){modal.show("#popup-copyright",false,"mfp-zoom")});$("#menu-toggle").click(function(){$("#menu-inner").toggleClass("expand")});$("#menu-inner").on("click","li",function(){var a=$(this).children("a").attr("href");if(!a||a.indexOf("#!")!=0){return true}if(!$("#content").hasClass("complete")){return false}routie(a);$("#menu-inner").removeClass("expand");slideTo();return false})}
/*! navigation helpers */
;function slideTo(a){var b=0;if(typeof a=="number"){b=a}else{if(a){b=$(a).offset().top||0}}$("body,html").animate({scrollTop:b},FX_SLIDE_DURATION)}function navUpdate(a){if(a===""){a="#!"}var b=$("#menu-inner");var c=b.find("li.active");var d=b.find("li > a[data-term='"+a+"']").parent();if(c[0]!==d[0]){c.removeClass("active");d.addClass("active")}}function replaceHash(a){if(location.hash=="#"+a||location.hash==a){$(window).hashchange()}else{routie(a)}}function loadExt(b,e){var c=$("#content");c.addClass("loading").removeClass("complete");var a;var d=function(f){setTimeout(function(){c.removeClass("loading").addClass("complete");c.htmlWithScript(f);if(e){e(f)}},FX_SLIDE_DURATION)};if(a=cacheStorage[b]){d(a)}else{$.ajax(b,{dataType:"html",success:function(f){cacheStorage[b]=f;d(f)},error:function(f,h,g){deferredRoute("","ajax/http_error.html","",function(){$(".fill-status").html(h);$(".fill-errmsg").html(g.toString())})()}})}}$(main);